# Diabetes Companion (V1) â€” Node + Express + Supabase Postgres

## 1) Create Supabase table
In Supabase SQL Editor, run the SQL in the section below.

```sql
-- Create the glucose_readings table
create table glucose_readings (
  id bigint generated by default as identity primary key,
  glucose_mgdl integer not null,
  measured_at timestamptz not null default now(),
  notes text,
  meal_tag text
);

-- Optional: Create an index on measured_at for faster sorting
create index idx_glucose_measured_at on glucose_readings(measured_at desc);
```

## 2) Local setup
```bash
cd diabetes-companion
npm install
cp .env.example .env
# edit .env and set DATABASE_URL to your Supabase connection string
# URL should look like: postgres://postgres.[ref]:[password]@[region].pooler.supabase.com:5432/postgres
npm run dev
```

## 3) API Endpoints
- `GET /health` - Check if API and DB are running
- `POST /api/glucose` - Log a glucose reading
  - Body: `{ "glucose_mgdl": 100, "measured_at": "2023-01-01T12:00:00Z", "notes": "Fasting", "meal_tag": "before_breakfast" }`
- `GET /api/glucose` - Get recent logs
- `DELETE /api/glucose/:id` - Delete a log by ID

## 4) Deployment (Render)
1. Push to GitHub.
2. Create New Web Service on Render.
3. Connect repo.
4. Set Build Command: `npm install`
5. Set Start Command: `node src/server.js`
6. Add Environment Variables:
   - `DATABASE_URL`: (Your Supabase connection string)
   - `PGSSLMODE`: `require` (optional but recommended)
